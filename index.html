<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <title>WebAR MVP - –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</title>
    <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1.4.0/dist/aframe-master.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stats.js/r17/Stats.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background: #f0f0f0;
        }
        
        a-scene {
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1;
        }
        
        .instructions {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 15px;
            z-index: 2;
            border-top: 2px solid #4285F4;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        
        .markers {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .marker-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .markers img {
            width: 120px;
            height: 120px;
            border: 2px solid #4285F4;
            border-radius: 8px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
            margin-bottom: 8px;
        }
        
        .marker-label {
            font-weight: bold;
            color: #4285F4;
        }
        
        #stats {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 100;
        }
        
        .status {
            margin-top: 10px;
            padding: 8px;
            background: #e8f0fe;
            border-radius: 4px;
            font-size: 14px;
        }
        
        #debug {
            position: fixed;
            top: 60px;
            left: 0;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px;
            font-size: 12px;
            z-index: 100;
        }
    </style>
</head>
<body>
    <a-scene 
        vr-mode-ui="enabled: false"
        embedded 
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        renderer="logarithmicDepthBuffer: true; antialias: true; alpha: true;"
        device-orientation-permission-ui="enabled: false"
    >

        <!-- –ú–∞—Ä–∫–µ—Ä HIRO: –¶–∏–ª–∏–Ω–¥—Ä -->
        <a-marker 
            type="pattern" 
            url="https://raw.githack.com/AR-js-org/AR.js/master/aframe/examples/image-tracking/nft/trex/trex-image/trex.patt"
            emitevents="true" 
            cursor="rayOrigin: mouse">
            <a-cylinder 
                color="#FF5733" 
                radius="0.5" 
                height="1" 
                position="0 0.5 0"
                rotation="0 180 0"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 3000">
            </a-cylinder>
        </a-marker>
        
        <!-- –ú–∞—Ä–∫–µ—Ä KANJI: –ö—É–± -->
        <a-marker 
            type="pattern" 
            url="https://raw.githack.com/AR-js-org/AR.js/master/aframe/examples/image-tracking/nft/kanji/kanji.patt"
            emitevents="true" 
            cursor="rayOrigin: mouse">
            <a-box 
                color="#4CC3D9" 
                position="0 0.5 0" 
                scale="0.5 0.5 0.5"
                animation="property: position; to: 0 1 0; dir: alternate; loop: true; dur: 2000">
            </a-box>
        </a-marker>
        
        <a-entity camera></a-entity>
    </a-scene>
    
    <div class="instructions">
        <h2>WebAR –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π MVP</h2>
        <p>–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –æ–¥–∏–Ω –∏–∑ –º–∞—Ä–∫–µ—Ä–æ–≤:</p>
        
        <div class="markers">
            <div class="marker-item">
                <img src="https://raw.githubusercontent.com/AR-js-org/AR.js/master/aframe/examples/image-tracking/nft/trex/trex-image/trex-image-big.jpeg" 
                     alt="HIRO –º–∞—Ä–∫–µ—Ä">
                <span class="marker-label">HIRO –º–∞—Ä–∫–µ—Ä</span>
                <p>3D-—Ü–∏–ª–∏–Ω–¥—Ä —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π</p>
            </div>
            
            <div class="marker-item">
                <img src="https://raw.githubusercontent.com/AR-js-org/AR.js/master/aframe/examples/image-tracking/nft/kanji/kanji.png" 
                     alt="KANJI –º–∞—Ä–∫–µ—Ä">
                <span class="marker-label">KANJI –º–∞—Ä–∫–µ—Ä</span>
                <p>–ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫—É–±</p>
            </div>
        </div>
        
        <div class="status">
            <div>–°—Ç–∞—Ç—É—Å: <span id="statusText">–ó–∞–≥—Ä—É–∑–∫–∞ AR...</span></div>
            <div>–ü–æ–¥–¥–µ—Ä–∂–∫–∞ WebAR: <span id="supportText">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span></div>
        </div>
        
        <p><small>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–∏ –º–∞—Ä–∫–µ—Ä—ã —Å —ç–∫—Ä–∞–Ω–∞ –¥—Ä—É–≥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏–ª–∏ —Ä–∞—Å–ø–µ—á–∞—Ç–∞–π—Ç–µ</small></p>
    </div>
    
    <div id="stats"></div>
    <div id="debug"></div>

    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ WebAR
        const isWebARSupported = () => {
            return navigator.mediaDevices && 
                   navigator.mediaDevices.getUserMedia && 
                   'xr' in navigator;
        };
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
        const updateStatus = (text) => {
            document.getElementById('statusText').textContent = text;
        };
        
        const updateSupport = (text) => {
            document.getElementById('supportText').textContent = text;
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            const stats = new Stats();
            stats.showPanel(0);
            document.getElementById('stats').appendChild(stats.dom);
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
            if (isWebARSupported()) {
                updateSupport("–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è üéâ");
            } else {
                updateSupport("–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è ‚ùå");
                updateStatus("–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç WebAR");
                return;
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π —Å—Ü–µ–Ω—ã
            const scene = document.querySelector('a-scene');
            
            scene.addEventListener('arjs-video-loaded', () => {
                updateStatus("–ö–∞–º–µ—Ä–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞. –ù–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ –º–∞—Ä–∫–µ—Ä...");
            });
            
            scene.addEventListener('renderstart', () => {
                updateStatus("AR –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!");
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                requestAnimationFrame(function updateStats() {
                    stats.update();
                    requestAnimationFrame(updateStats);
                });
            });
            
            // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –º–∞—Ä–∫–µ—Ä–æ–≤
            const hiroMarker = document.querySelector('a-marker[url*="trex.patt"]');
            const kanjiMarker = document.querySelector('a-marker[url*="kanji.patt"]');
            
            hiroMarker.addEventListener('markerFound', () => {
                console.log('–ú–∞—Ä–∫–µ—Ä HIRO –æ–±–Ω–∞—Ä—É–∂–µ–Ω');
                updateStatus("–ú–∞—Ä–∫–µ—Ä HIRO —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω!");
            });
            
            hiroMarker.addEventListener('markerLost', () => {
                updateStatus("–ò—â—É –º–∞—Ä–∫–µ—Ä—ã...");
            });
            
            kanjiMarker.addEventListener('markerFound', () => {
                console.log('–ú–∞—Ä–∫–µ—Ä KANJI –æ–±–Ω–∞—Ä—É–∂–µ–Ω');
                updateStatus("–ú–∞—Ä–∫–µ—Ä KANJI —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω!");
            });
            
            // –û—Ç–ª–∞–¥–∫–∞
            const debugEl = document.getElementById('debug');
            setInterval(() => {
                const markers = scene.querySelectorAll('a-marker');
                let debugText = `–í–∏–¥–∏–º—ã—Ö –º–∞—Ä–∫–µ—Ä–æ–≤: ${Array.from(markers).filter(m => m.object3D.visible).length}`;
                
                if (scene.systems && scene.systems.arjs) {
                    debugText += ` | FPS: ${Math.round(stats.fps || 0)}`;
                }
                
                debugEl.textContent = debugText;
            }, 500);
        });
    </script>
</body>
</html>
